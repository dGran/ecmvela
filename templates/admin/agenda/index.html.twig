{% extends 'base_admin.html.twig' %}

{% block title %}Agenda | {% endblock %}

{% block main %}
    {{ component(
        'crudHeaderComponent',
        {
            section: 'Agenda',
            title: 'Citas',
            description: 'Gestión de citas, organización de agenda.'
        }
    ) }}

    <div class="flex items-start justify-between space-x-8 py-8 px-4">

        <div class="max-w-sm w-full shadow-lg">
            <div class="md:p-8 p-5 dark:bg-gray-800 bg-white rounded-t">
                <div class="px-4 flex items-center justify-between">
                    <p class="text-base font-bold text-gray-800">{{ calendar_month_data.month_name|trans }} {{ calendar_month_data.year }}</p>
                    <div class="flex items-center space-x-3">
                        <a href="{{ path('admin_agenda', {'day': 'now'}) }}">hoy</a>
                        <a href="{{ path('admin_agenda', {'day': day|date_modify('-1 month')|date('Y-m-01')}) }}"
                           class="focus:text-gray-400 hover:text-gray-400 text-gray-800 focus:outline-none">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                <polyline points="15 6 9 12 15 18" />
                            </svg>
                        </a>
                        <a href="{{ path('admin_agenda', {'day': day|date_modify('+1 month')|date('Y-m-01')}) }}"
                           class="focus:text-gray-400 hover:text-gray-400 text-gray-800 focus:outline-none">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler  icon-tabler-chevron-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                <polyline points="9 6 15 12 9 18" />
                            </svg>
                        </a>
                    </div>
                </div>
                <p class="px-4 pt-0.5 text-xs text-gray-500">{{ calendar_month_data.business_days }} días laboralaes</p>

                <div class="flex items-center justify-between pt-6 overflow-x-auto">
                    <table class="w-full">
                        <thead>
                        <tr>
                            {% for day_of_the_week in days_of_the_week %}
                            <th>
                                <span class="text-base font-medium text-center text-gray-800 dark:text-gray-100">{{ day_of_the_week['short_name']|trans }}</span>
                            </th>
                            {% endfor %}
                        </tr>
                        </thead>
                        <tbody>
                        {% set firstDay = date(calendar_month_data.year ~ '-' ~ calendar_month_data.month ~ '-01') %}
                        {% set day_counter = 1 %}
                        {% for week in range(1, 6) %}
                            <tr>
                                {% for day in range(1, 7) %}
                                    {% if (week == 1 and day >= firstDay.format('N')) or (week > 1 and day_counter <= calendar_month_data.number_of_days) %}
                                        <td>
                                            {% if day_counter <= calendar_month_data.number_of_days %}
                                                <div class="px-0 py-0.5 flex w-full justify-center">
                                                    {% set string_select_day = date(calendar_month_data.year ~ '-' ~ calendar_month_data.month ~ '-' ~ day_counter) %}
                                                    {% set select_day = string_select_day|date('Y-m-d') %}
                                                    {% if day_counter in calendar_month_data.public_holidays %}
                                                        {% set color_day = 'red' %}
                                                        {% set color_current_day = 'red' %}
                                                    {% else %}
                                                        {% set color_day = 'gray' %}
                                                        {% set color_current_day = 'blue' %}
                                                    {% endif %}
                                                    <a href="{{ path('admin_agenda', {'day': select_day}) }}"
                                                       class="text-base font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 w-8 h-8 flex items-center justify-center rounded-full
                                                        {% if day_of_the_month == day_counter %}focus:ring-{{ color_current_day }}-500 focus:bg-{{ color_current_day }}-500 hover:bg-{{ color_current_day }}-500 text-white bg-{{ color_current_day }}-500 pointer-events-none
                                                        {% else %}focus:ring-{{ color_day }}-200 focus:bg-{{ color_day }}-100 hover:bg-{{ color_day }}-100 bg-transparent text-{{ color_day }}-500{% endif %}"
                                                    >
                                                        {% if day_counter not in calendar_month_data.public_holidays %}
                                                            <span class="line-through text-gray-400">{{ day_counter }}</span>
                                                        {% else %}
                                                            {{ day_counter }}
                                                        {% endif %}
                                                    </a>
                                                </div>
                                            {% endif %}
                                        </td>
                                        {% set day_counter = day_counter + 1 %}
                                    {% else %}
                                        <td></td>
                                    {% endif %}
                                {% endfor %}
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="md:py-8 py-5 md:px-16 px-5 dark:bg-gray-700 bg-gray-50 rounded-b">
                <div class="px-4 flex flex-col space-y-3">
                    <div class="border-b pb-4 border-gray-400 border-dashed">
                        <p class="text-xs font-light leading-4 text-gray-500">9:30 - 10:30</p>
                        <a tabindex="0" class="focus:outline-none text-lg font-medium leading-5 text-gray-800 mt-2">Coco - Laura</a>
                        <p class="text-sm pt-2 leading-4 leading-none text-gray-600 dark:text-gray-300">Baño y corte</p>
                    </div>
                    <div class="border-b pb-4 border-gray-400 border-dashed">
                        <p class="text-xs font-light leading-4 text-gray-500">10:30 - 12:00</p>
                        <a tabindex="0" class="focus:outline-none text-lg font-medium leading-5 text-gray-800 mt-2">Vitolo - Merce</a>
                        <p class="text-sm pt-2 leading-4 leading-none text-gray-600 dark:text-gray-300">ver historial</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex-1">
            <p>Citas</p>
            .... boton cancelar cita (eliminar) cambiar de fecha, generar ticket
            <p>Huecos disponibles</p>
            .... en cada hueco boton "Reservar"
            <p>y me cargo los slots</p>
            <p>en la tabla booking añadir un flag de recordatorio enviado por si se quiere forzar el reenvio de recodatorios o si se programa a 2 horas diferentes o si se pone un boton enviar redordatorios</p>
            <p>texto del recodatorio configurable en "configuracion"</p>
            <p>almacenar fecha y horas disponibles del cliente</p>
            <p>podremos buscar fechas disponibles según la disponibilidad del cliente</p>

            {% for slot in slots %}
                <div class="border-b flex items-center space-x-3 bg-green-50 even:bg-transparent">
                    <p class="py-2 px-3 border-r text-sm">{{ slot|date('H:i') }}</p>
                    <p class="py-2 px-3 w-full text-sm text-center">LIBRE</p>
                </div>
            {% endfor %}
        </div>
    </div>



    <section class="bg-white dark:bg-gray-900 antialiased">
        <div class="max-w-screen-xl px-4 py-8 mx-auto lg:px-6 sm:py-16 lg:py-24">
            <div class="max-w-3xl mx-auto text-center">
                <h2 class="text-4xl font-extrabold leading-tight tracking-tight text-gray-900 dark:text-white">
                    Schedule
                </h2>

                {% for slot in slots %}
                    {% include 'admin/agenda/slots/_slot.html.twig' %}
                {% endfor %}

                <div class="mt-4">
                    <a href="#" title=""
                       class="inline-flex items-center text-lg font-medium text-primary-600 hover:underline dark:text-primary-500">
                        Learn more about our agenda
                        <svg aria-hidden="true" class="w-5 h-5 ml-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                             fill="currentColor">
                            <path fill-rule="evenodd"
                                  d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z"
                                  clip-rule="evenodd" />
                        </svg>
                    </a>
                </div>
            </div>



            <div class="flow-root max-w-3xl mx-auto mt-8 sm:mt-12 lg:mt-16">
                <div class="-my-4 divide-y divide-gray-200 dark:divide-gray-700">
                    <div class="flex flex-col gap-2 py-4 sm:gap-6 sm:flex-row sm:items-center">
                        <p class="w-32 text-lg font-normal text-gray-500 sm:text-right dark:text-gray-400 shrink-0">
                            09:00 - 09:00
                        </p>
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                            <a href="#" class="hover:underline">Opening remarks</a>
                        </h3>
                    </div>
                </div>
            </div>

        </div>
    </section>
{% endblock %}
